version: '3.8'

services:
  api:
    build: .
    container_name: fastapi
    command: uvicorn app.main:app --host 0.0.0.0 --reload
    volumes:
      - ./app:/code/app
    ports:
      - "80:8000"
    depends_on:
      - db
#    labels:
#      - "traefik.enable=true"
#      - "traefik.http.routers.fastapi.rule=Host(`fastapi.localhost`)"
  db:
    image: mongodb/mongodb-community-server
    container_name: mongodb
    env_file:
      - ./.env
    ports:
      - "27017:27017"
    volumes:
      - ./data:/data/db
#    environment:
#      - POSTGRES_USER=fastapi_traefik
#      - POSTGRES_PASSWORD=fastapi_traefik
#      - POSTGRES_DB=fastapi_traefik
#  traefik:
#    image: traefik:v2.10
#    container_name: traefik
#    ports:
#      - 80:80
#      - 9999:8080
#    volumes:
#      - "./traefik.dev.toml:/etc/traefik/traefik.toml"
#      - //var/run/docker.sock://var/run/docker.sock

#volumes:
#  postgres_data: